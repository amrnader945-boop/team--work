<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AMR LAB â€” Patient Report</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="center-card">
    <div class="card report" id="reportCard" aria-live="polite">
      <div class="header">
        <div>
          <h2 id="labTitle">AMR LAB</h2>
          <p class="muted">Patient Report</p>
        </div>
        <div class="logo">ğŸ¥</div>
      </div>

      <div class="info">
        <div class="row"><span>ID</span><strong id="p_id">â€”</strong></div>
        <div class="row"><span>Name</span><strong id="p_name">â€”</strong></div>
        <div class="row"><span>Age</span><strong id="p_age">â€”</strong></div>
        <div class="row"><span>Gender</span><strong id="p_gender">â€”</strong></div>
        <div class="row"><span>Clinic</span><strong id="p_clinic">â€”</strong></div>
        <div class="row"><span>Doctor</span><strong id="p_doctor">â€”</strong></div>
        <div class="row"><span>Phone</span><strong id="p_phone">â€”</strong></div>
        <div class="row"><span>Email</span><strong id="p_email">â€”</strong></div>
      </div>

      <h3 class="results-title">Test Results</h3>
      <div class="tests">
        <div class="row"><span>ABS</span><strong id="p_abs">â€”</strong></div>
        <div class="row"><span>CONC</span><strong id="p_conc">â€”</strong></div>
        <div class="row"><span>TRANS</span><strong id="p_trans">â€”</strong></div>
      </div>

      <div class="actions">
        <a id="whatsappBtn" class="btn whatsapp" target="_blank" rel="noopener noreferrer">
          <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" width="20" alt=""> WhatsApp
        </a>

        <a id="smsBtn" class="btn sms" target="_blank" rel="noopener noreferrer">
          <img src="https://cdn-icons-png.flaticon.com/512/732/732200.png" width="20" alt=""> Send SMS
        </a>

        <button id="backBtn" class="btn ghost">Back to Login</button>
      </div>
    </div>
  </main>

<script>
// read patient data from localStorage
(function() {
  const patientJSON = localStorage.getItem('patientData');
  if (!patientJSON) {
    // if no data -> redirect to login
    window.location.href = "index.html";
    return;
  }

  const patient = JSON.parse(patientJSON);

  // populate fields
  document.getElementById('p_id').innerText = patient.id || '';
  document.getElementById('p_name').innerText = patient.name || '';
  document.getElementById('p_age').innerText = patient.age || '';
  document.getElementById('p_gender').innerText = patient.gender || '';
  document.getElementById('p_clinic').innerText = patient.clinic || '';
  document.getElementById('p_doctor').innerText = patient.doctor || '';
  document.getElementById('p_phone').innerText = patient.phone || '';
  document.getElementById('p_email').innerText = patient.email || '';

  document.getElementById('p_abs').innerText = patient.abs ?? 'â€”';
  document.getElementById('p_conc').innerText = patient.conc ?? 'â€”';
  document.getElementById('p_trans').innerText = patient.trans ?? 'â€”';

  // prepare links
  const siteRoot = window.location.origin + window.location.pathname.replace(/\/[^/]*$/, '/') ; // folder path
  const patientLink = siteRoot + "patient.html"; // link to the page itself (or you can point to index + query)

  const phone = (patient.phone || '').replace(/\s+/g, '');
  // WhatsApp: use wa.me with phone in international format (no plus)
  const waNumber = phone.replace('+','');
  const waText = encodeURIComponent(`Hello ${patient.name}, your lab results are ready. View: ${siteRoot}`);
  document.getElementById('whatsappBtn').href = `https://wa.me/${waNumber}?text=${waText}`;

  // SMS: use sms: scheme â€” on mobile this opens SMS app
  const smsText = encodeURIComponent(`Your lab results are ready. View: ${siteRoot}`);
  if (phone) {
    document.getElementById('smsBtn').href = `sms:${phone}?body=${smsText}`;
  } else {
    // hide if no phone
    document.getElementById('smsBtn').style.display = 'none';
  }

  document.getElementById('backBtn').addEventListener('click', () => {
    localStorage.removeItem('patientData'); // optional: clear session
    window.location.href = "index.html";
  });
})();
</script>
</body>
</html>
